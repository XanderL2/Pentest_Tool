import cv2, socket, struct, pickle;








def ReceiveVideo(ip, port=10000):


    # Create Socket for the connection 
    clientSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM);


    # Connect to server
    serverAddress = (ip, 10000);
    clientSocket.connect(serverAddress);


    print("Presiona Q para salir de la ventana");


    while True:

        # Vamos recibiendo de 4 bytes en 4 bytes 
        lengthBytes = clientSocket.recv(4)
        length = struct.unpack('!I', lengthBytes)[0] #Obtenemos la longitud de los bytes en un numero entero
        
        

        # Declaramos una variable de tipo binario
        frameData = b''


        while len(frameData) < length:

            packet = clientSocket.recv(length - len(frameData)) #Vamos recibiendo la data, cuando la resta sea 0 esto sera '' y saldremos

            if not packet:
                break

            frameData+= packet
        
        # Deserializar el fotograma utilizando pickle
        frame = pickle.loads(frameData)
        

        

        # Mostramos el fotograma
        cv2.imshow('Frame', frame)
        

        # Exit 
        if cv2.waitKey(1) & 0xFF == ord('q'):
            break




    # Cerrar el socket y cerrar la ventana
    clientSocket .close()
    cv2.destroyAllWindows()

