import re, subprocess; 

def escaneo_rapido(ip, netmask):

    #Verificamos la cantidad de 255s existentes en la mascara para determinar el rango de escaneos
    len_netmask = len(re.findall(r"\d{3}", netmask))
    

    #Validamos la Mascara en notacion CDIR (La notacion con Slashes)
    if (len_netmask == 2):
        len_netmask = "/8";
    elif (len_netmask == 2):
        len_netmask = "/16";
    elif (len_netmask == 3):
        len_netmask = "/24";
    
    #Creamos una lista donde guardaremos las estadisticas de los Hosts
    hosts = [];
    #Ejecutamos el comando como subproceso obteniendo la salida estandar del comando
    result = subprocess.run(["sudo","arp-scan", "--interface=wlan0", "wlan0", f"{ip}{len_netmask}"], capture_output=True, text=True).stdout;
    

    #Mediante una expresion regular obtenemos informacion como la IP, Mac y Marca del dispositivo
    #\s+ indica que habran uno o mas caracteres de espacio en blanco
    dispositivos = re.findall(r"(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d+)\s+([0-9a-fA-F:]+)\s+([^\n]+)", result);



    for i in range(len(dispositivos)):
        diccionario = {}; 
        for j in range(len(dispositivos[i])):
            diccionario.update({"IP": dispositivos[i][0], "Mac Address": dispositivos[i][1], "Marca": dispositivos[i][2]});    
    
        hosts.append(diccionario);
    
    return hosts  #?Retorna una lista de diccionarios


